(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const B=4,q=2,M={earl_grey:{name:"Earl Grey",steepTime:3,milk:!1,sugar:"optional"},english:{name:"English Breakfast",steepTime:4,milk:!0,sugar:"optional"},peppermint:{name:"Peppermint",steepTime:2,milk:!1,sugar:"none"},chai:{name:"Chai",steepTime:5,milk:!0,sugar:"required"}},x=["earl_grey","english","peppermint","chai"];function k(e){return{id:e,kettleState:"empty",kettleTimer:0,cupState:"empty",cupTeaType:null,pendingTeaType:null,teabagChangeTimer:0,steepTimer:0,steepTarget:0,hasMilk:!1,sugarCount:0}}function G(e){return e.upgrades.includes("faster_kettle")?3:4}function K(e,t){switch(e.kettleState){case"empty":e.kettleState="filling",e.kettleTimer=1;break;case"full":e.kettleState="boiling",e.kettleTimer=G(t);break;case"ready":e.cupState==="has_teabag"&&e.cupTeaType&&(e.kettleState="empty",e.cupState="steeping",e.steepTimer=0,e.steepTarget=M[e.cupTeaType].steepTime);break}}function U(e,t){e.cupState==="empty"?(e.cupState="has_teabag",e.cupTeaType=t):e.cupState==="has_teabag"&&e.cupTeaType!==t&&e.teabagChangeTimer===0&&(e.pendingTeaType=t,e.teabagChangeTimer=1)}function V(e){(e.cupState==="steeping"||e.cupState==="ready")&&e.sugarCount++}function W(e){(e.cupState==="steeping"||e.cupState==="ready")&&!e.hasMilk&&(e.hasMilk=!0)}function X(e,t){(e.kettleState==="filling"||e.kettleState==="boiling")&&(e.kettleTimer-=t,e.kettleTimer<=0&&(e.kettleTimer=0,e.kettleState==="filling"?e.kettleState="full":e.kettleState==="boiling"&&(e.kettleState="ready"))),e.teabagChangeTimer>0&&(e.teabagChangeTimer-=t,e.teabagChangeTimer<=0&&(e.teabagChangeTimer=0,e.pendingTeaType&&(e.cupTeaType=e.pendingTeaType,e.pendingTeaType=null))),e.cupState==="steeping"&&(e.steepTimer+=t,e.steepTimer>=e.steepTarget&&(e.cupState="ready"))}function E(e){e.cupState="empty",e.cupTeaType=null,e.pendingTeaType=null,e.teabagChangeTimer=0,e.steepTimer=0,e.steepTarget=0,e.hasMilk=!1,e.sugarCount=0}function Q(e){switch(e.kettleState){case"empty":return"Empty";case"filling":return"Filling...";case"full":return"Full";case"boiling":return`Boiling ${e.kettleTimer.toFixed(1)}s`;case"ready":return"Ready!"}}function Y(e){if(e.teabagChangeTimer>0)return"Changing...";switch(e.cupState){case"empty":return"Empty";case"has_teabag":return"Add water";case"steeping":return`Steeping ${e.steepTimer.toFixed(1)}s`;case"ready":return"Ready!"}}function w(e){return e.upgrades.includes("relationship_building")?q+1:q}let z=0;function j(e){const t=Math.max(18,40-(e.day-1)*8);return e.upgrades.includes("patience_boost")?t*1.2:t}function $(e){return 6+(e-1)*3}function J(e){return Math.max(3,5-(e-1)*.7)}function A(e){return Math.min(5,2+e)}function Z(e){const t=j(e);return{id:z++,order:x[Math.floor(Math.random()*x.length)],patience:t,maxPatience:t}}function ee(e,t){for(const i of e.customers)i.patience-=t;const n=e.customers.filter(i=>i.patience<=0).length;n>0&&(e.wrongOrdersToday+=n,e.wrongOrdersToday>=w(e)&&(e.phase="gameover")),e.customers=e.customers.filter(i=>i.patience>0);const a=A(e.day);if(e.customers.length<a&&e.customersServed+e.customers.length<e.customersTotal){const i=J(e.day);Math.random()<t/i&&e.customers.push(Z(e))}}function te(e,t,n){let a=2;const i=Math.abs(e.steepTimer-t.steepTime);return i<=1?a+=1:i>3&&(a-=1),t.milk&&e.hasMilk?a+=1:(t.milk&&!e.hasMilk||!t.milk&&e.hasMilk)&&(a-=1),t.sugar==="required"&&e.sugarCount>0?a+=1:(t.sugar==="required"&&e.sugarCount===0||t.sugar==="none"&&e.sugarCount>0)&&(a-=1),n.upgrades.includes("premium_cups")&&(a+=1),Math.max(0,Math.min(5,a))}function ne(e,t){if(e.servingFromStation===null)return 0;const n=e.stations[e.servingFromStation],a=e.customers[t];if(!n||!a||!n.cupTeaType)return 0;let i=0;return n.cupTeaType!==a.order?(e.wrongOrdersToday++,e.wrongOrdersToday>=w(e)&&(e.phase="gameover")):i=te(n,M[a.order],e),e.customers.splice(t,1),e.customersServed++,e.tips+=i,e.dayTips+=i,e.servingFromStation=null,i}function ie(e){return M[e].name}const O=180;function _(){return{phase:"playing",day:1,tips:0,dayTips:0,dayTimer:O,customersServed:0,customersTotal:$(1),wrongOrdersToday:0,stations:[k(0),k(1)],customers:[],servingFromStation:null,upgrades:[]}}function se(e,t){if(e.phase==="playing"){e.dayTimer-=t;for(const n of e.stations)X(n,t);ee(e,t),(e.dayTimer<=0||e.customersServed>=e.customersTotal)&&ae(e)}}function ae(e){e.day>=B?e.phase="won":e.phase="shopping"}function re(e){if(e.day>=B){e.phase="won";return}e.day++,e.phase="playing",e.dayTimer=O,e.dayTips=0,e.customersServed=0,e.customersTotal=$(e.day),e.wrongOrdersToday=0,e.customers=[],e.servingFromStation=null;for(const t of e.stations)t.kettleState="empty",t.kettleTimer=0,E(t);e.upgrades.includes("third_station")&&e.stations.length<3&&e.stations.push(k(2))}function oe(e){const t=Math.floor(e/60),n=Math.floor(e%60);return`${t}:${n.toString().padStart(2,"0")}`}const D=[{id:"faster_kettle",name:"Faster Kettle",description:"Boil time reduced from 4s to 3s",cost:10},{id:"third_station",name:"Third Station",description:"Unlock a third tea station",cost:25},{id:"patience_boost",name:"Comfy Chairs",description:"Customers wait 20% longer",cost:15},{id:"premium_cups",name:"Premium Cups",description:"+1 tip per order",cost:20},{id:"relationship_building",name:"Relationship Building",description:"Customers forgive one extra mistake",cost:15}];function ce(e,t){return e.tips>=t.cost&&!e.upgrades.includes(t.id)}function ue(e){de(e),pe(e),me(e);const t=document.getElementById("pause");e.phase==="paused"?t.classList.remove("hidden"):t.classList.add("hidden");const n=document.getElementById("shop");e.phase==="shopping"?n.classList.contains("hidden")&&(n.classList.remove("hidden"),P(e)):n.classList.add("hidden");const a=document.getElementById("gameover");e.phase==="gameover"?a.classList.contains("hidden")&&(a.classList.remove("hidden"),document.getElementById("gameover-day").textContent=String(e.day),document.getElementById("gameover-tips").textContent=String(e.tips)):a.classList.add("hidden");const i=document.getElementById("win");e.phase==="won"?i.classList.contains("hidden")&&(i.classList.remove("hidden"),document.getElementById("win-tips").textContent=String(e.tips)):i.classList.add("hidden")}function le(e){P(e)}function de(e){document.getElementById("day-display").textContent=`Day ${e.day}/${B}`,document.getElementById("tips-display").textContent=`Tips: $${e.tips}`,document.getElementById("time-display").textContent=`Time: ${oe(e.dayTimer)}`;const t=document.getElementById("complaints-display");if(t){const n=w(e),a='<span class="complaint filled">X</span>'.repeat(e.wrongOrdersToday),i='<span class="complaint">X</span>'.repeat(n-e.wrongOrdersToday);t.innerHTML='<span class="complaints-label">Complaints:</span>'+a+i}}function pe(e){const t=document.querySelectorAll(".customer-slot"),n=A(e.day),a=document.getElementById("sink");a&&(e.servingFromStation!==null?a.classList.add("active"):a.classList.remove("active")),t.forEach((i,s)=>{const u=e.customers[s],r=i;if(s>=n){r.classList.add("unavailable"),r.classList.remove("occupied","serving-mode"),r.innerHTML='<div class="slot-locked">?</div>';return}if(r.classList.remove("unavailable"),u){r.classList.add("occupied"),e.servingFromStation!==null?r.classList.add("serving-mode"):r.classList.remove("serving-mode");const d=u.patience/u.maxPatience*100,p=d<30;r.innerHTML=`
        <div class="customer">
          <div class="customer-face"></div>
          <div class="customer-order">${ie(u.order)}</div>
        </div>
        <div class="customer-patience">
          <div class="patience-bar ${p?"low":""}" style="width: ${d}%"></div>
        </div>
      `}else r.classList.remove("occupied","serving-mode"),r.innerHTML=""})}function me(e){const t=document.getElementById("stations"),n=document.getElementById("station-3-locked");n&&(e.upgrades.includes("third_station")?n.classList.add("hidden"):n.classList.remove("hidden")),e.upgrades.includes("third_station")&&!document.querySelector('[data-station="2"]')&&t.insertAdjacentHTML("beforeend",`
      <div class="station" data-station="2">
        <div class="station-label">Station 3</div>
        <div class="station-top">
          <div class="kettle" data-action="kettle">
            <div class="kettle-body"></div>
            <div class="kettle-status">Empty</div>
          </div>
          <div class="cup" data-action="cup">
            <div class="cup-body">
              <div class="cup-contents"></div>
              <div class="sugar-crystals"></div>
            </div>
            <div class="cup-status">Empty</div>
          </div>
        </div>
        <div class="station-bottom">
          <div class="teabags">
            <div class="teabag" data-tea="earl_grey" data-action="teabag">EG</div>
            <div class="teabag" data-tea="english" data-action="teabag">EB</div>
            <div class="teabag" data-tea="peppermint" data-action="teabag">PM</div>
            <div class="teabag" data-tea="chai" data-action="teabag">CH</div>
          </div>
          <div class="additions">
            <div class="addition" data-action="sugar">Sugar</div>
            <div class="addition" data-action="milk">Milk</div>
          </div>
        </div>
      </div>
    `),e.stations.forEach((a,i)=>{const s=document.querySelector(`[data-station="${i}"]`);if(!s)return;const u=e.servingFromStation===i;ge(a,s,u)})}function ge(e,t,n){const a=t.querySelector(".kettle");a.className=`kettle ${e.kettleState}`,t.querySelector(".kettle-status").textContent=Q(e);const i=t.querySelector(".cup");let s="cup";e.cupTeaType&&(s+=` ${e.cupTeaType}`),e.cupState==="has_teabag"&&(s+=" has-teabag"),(e.cupState==="steeping"||e.cupState==="ready")&&(s+=" has-tea"),e.cupState==="steeping"&&(s+=" steeping"),e.hasMilk&&(s+=" has-milk"),e.sugarCount>0&&(s+=" has-sugar"),e.cupState==="ready"&&(s+=" ready"),n&&(e.cupState==="steeping"||e.cupState==="ready")&&(s+=" serving"),e.teabagChangeTimer>0&&(s+=" changing-teabag"),i.className=s,t.querySelector(".cup-status").textContent=Y(e)}function P(e){document.getElementById("shop-tips").textContent=`Tips: $${e.tips}`;const t=document.getElementById("upgrades");t.innerHTML="";for(const n of D){const a=e.upgrades.includes(n.id),i=ce(e,n),s=document.createElement("div");s.className=`upgrade ${a?"owned":""} ${!i&&!a?"locked":""}`,s.dataset.upgradeId=n.id,s.innerHTML=`
      <div class="upgrade-name">${n.name}</div>
      <div class="upgrade-desc">${n.description}</div>
      <div class="upgrade-cost">${a?"OWNED":`$${n.cost}`}</div>
    `,t.appendChild(s)}}function fe(e,t,n){const a=document.createElement("div");a.className="tip-popup",a.textContent=e>0?`+$${e}`:"$0",a.style.left=`${t}px`,a.style.top=`${n}px`,document.body.appendChild(a),setTimeout(()=>a.remove(),1e3)}let S=null,f=!1;function ye(){return f=!f,f}function R(){return S||(S=new AudioContext),S}function c(e,t,n="square",a=.3){if(f)return;const i=R(),s=i.createOscillator(),u=i.createGain();s.connect(u),u.connect(i.destination),s.type=n,s.frequency.setValueAtTime(e,i.currentTime),u.gain.setValueAtTime(a,i.currentTime),u.gain.exponentialRampToValueAtTime(.01,i.currentTime+t),s.start(i.currentTime),s.stop(i.currentTime+t)}function y(e,t=.1){if(f)return;const n=R(),a=n.sampleRate*e,i=n.createBuffer(1,a,n.sampleRate),s=i.getChannelData(0);for(let p=0;p<a;p++)s[p]=Math.random()*2-1;const u=n.createBufferSource(),r=n.createGain(),d=n.createBiquadFilter();u.buffer=i,d.type="lowpass",d.frequency.setValueAtTime(1e3,n.currentTime),u.connect(d),d.connect(r),r.connect(n.destination),r.gain.setValueAtTime(t,n.currentTime),r.gain.exponentialRampToValueAtTime(.01,n.currentTime+e),u.start(n.currentTime),u.stop(n.currentTime+e)}function Te(){y(.3,.05),c(200,.1,"sine",.1),setTimeout(()=>c(250,.1,"sine",.1),100)}function ve(){y(.2,.08),c(150,.15,"triangle",.15)}function he(){c(880,.1,"sine",.2),setTimeout(()=>c(1100,.15,"sine",.2),100)}function Se(){for(let e=0;e<5;e++)setTimeout(()=>{c(400-e*40,.08,"sine",.1),y(.05,.03)},e*60)}function ke(){c(180,.1,"triangle",.2),setTimeout(()=>c(120,.08,"triangle",.15),50)}function Ee(){c(523,.15,"sine",.15),setTimeout(()=>c(659,.15,"sine",.15),120),setTimeout(()=>c(784,.2,"sine",.15),240)}function be(){y(.15,.05),c(300,.1,"sine",.1)}function Ce(){for(let e=0;e<3;e++)setTimeout(()=>{c(1200+Math.random()*400,.05,"square",.08)},e*40)}function Le(e){e>=4?(c(523,.1,"square",.2),setTimeout(()=>c(659,.1,"square",.2),80),setTimeout(()=>c(784,.1,"square",.2),160),setTimeout(()=>c(1047,.2,"square",.25),240)):e>=2?(c(440,.1,"square",.2),setTimeout(()=>c(554,.15,"square",.2),100)):(c(330,.15,"square",.2),setTimeout(()=>c(262,.2,"square",.2),120))}function Ie(){c(660,.08,"sine",.15),setTimeout(()=>c(880,.12,"sine",.15),80)}function Be(){c(294,.15,"square",.2),setTimeout(()=>c(220,.2,"square",.2),100),setTimeout(()=>c(165,.25,"square",.15),200)}function Me(){[523,587,659,784].forEach((t,n)=>{setTimeout(()=>c(t,.2,"square",.2),n*150)})}function we(){c(988,.08,"square",.2),setTimeout(()=>c(1319,.15,"square",.25),80)}function F(){c(800,.05,"square",.15)}function qe(){c(600,.1,"square",.2),setTimeout(()=>c(400,.15,"square",.2),80)}function xe(){c(400,.1,"square",.2),setTimeout(()=>c(600,.15,"square",.2),80)}function Fe(){y(.3,.1),c(200,.15,"triangle",.15),setTimeout(()=>c(150,.15,"triangle",.1),100),setTimeout(()=>c(100,.2,"triangle",.08),200)}let o,b=0,T=!1,C=[],L=[],v=0,I="playing";function $e(){o=_(),Ae(),b=performance.now(),requestAnimationFrame(N)}function Ae(){const e=document.getElementById("stations"),t=document.getElementById("customer-queue");e.addEventListener("click",r=>{const d=r.target,p=d.closest(".station");if(!p)return;const m=parseInt(p.dataset.station||"0"),l=o.stations[m];if(!l)return;const g=d.closest("[data-action]");if(!g)return;switch(g.dataset.action){case"kettle":const h=l.kettleState;K(l,o),h==="empty"&&l.kettleState==="filling"?Te():h==="full"&&l.kettleState==="boiling"?ve():h==="ready"&&l.cupState==="steeping"&&Se();break;case"teabag":const H=g.dataset.tea;l.cupState==="empty"&&ke(),U(l,H);break;case"sugar":(l.cupState==="steeping"||l.cupState==="ready")&&Ce(),V(l);break;case"milk":(l.cupState==="steeping"||l.cupState==="ready")&&!l.hasMilk&&be(),W(l);break;case"cup":(l.cupState==="steeping"||l.cupState==="ready")&&(F(),o.servingFromStation===m?o.servingFromStation=null:o.servingFromStation=m);break}}),t.addEventListener("click",r=>{if(o.servingFromStation===null)return;const d=r.target.closest(".customer-slot");if(!d)return;const p=parseInt(d.dataset.slot||"0");if(!o.customers[p])return;const m=o.servingFromStation,l=ne(o,p);Le(l);const g=d.getBoundingClientRect();fe(l,g.left+g.width/2,g.top),E(o.stations[m])}),document.getElementById("next-day-btn").addEventListener("click",()=>{F(),re(o),v=0}),document.getElementById("sink").addEventListener("click",()=>{if(o.servingFromStation===null)return;const r=o.stations[o.servingFromStation];r&&(r.cupState==="steeping"||r.cupState==="ready")&&(Fe(),E(r),o.servingFromStation=null)}),document.addEventListener("click",r=>{const d=r.target;if(!d.closest("#upgrades"))return;const p=d.closest(".upgrade");if(!p||p.classList.contains("owned")||p.classList.contains("locked"))return;const m=p.dataset.upgradeId;if(m){const l=D.find(g=>g.id===m);l&&o.tips>=l.cost&&(o.tips-=l.cost,o.upgrades.push(m),we(),le(o))}});const n=document.getElementById("restart-confirm");document.getElementById("restart-yes").addEventListener("click",u),document.getElementById("restart-no").addEventListener("click",s),document.getElementById("gameover-restart-btn").addEventListener("click",u),document.getElementById("win-restart-btn").addEventListener("click",u);const a=document.getElementById("mute-btn");a.addEventListener("click",()=>{const r=ye();a.textContent=r?"Sound: OFF":"Sound: ON"});function i(){T=!0,n.classList.remove("hidden")}function s(){T=!1,n.classList.add("hidden")}function u(){T=!1,n.classList.add("hidden"),o=_(),C=[],L=[],v=0,I="playing"}document.addEventListener("keydown",r=>{if(T){r.key==="Escape"?(r.preventDefault(),s()):r.key==="Enter"&&(r.preventDefault(),u());return}(r.key==="p"||r.key==="P"||r.key===" "||r.key==="Escape")&&(r.preventDefault(),o.phase==="playing"?r.key==="Escape"&&o.servingFromStation!==null?o.servingFromStation=null:(o.phase="paused",qe()):o.phase==="paused"&&(o.phase="playing",xe())),(r.key==="r"||r.key==="R")&&(r.preventDefault(),o.phase==="gameover"||o.phase==="won"?u():o.phase!=="shopping"&&i())})}function N(e){const t=(e-b)/1e3;if(b=e,o.phase==="playing"){const n=o.customers.map(s=>s.id);se(o,t),o.stations.forEach((s,u)=>{C[u]==="boiling"&&s.kettleState==="ready"&&he(),L[u]==="steeping"&&s.cupState==="ready"&&Ee(),C[u]=s.kettleState,L[u]=s.cupState}),o.customers.length>v&&Ie();const a=o.customers.map(s=>s.id);n.filter(s=>!a.includes(s)).length>0&&o.phase==="playing"&&Be(),v=o.customers.length}I==="playing"&&o.phase==="shopping"&&Me(),I=o.phase,ue(o),requestAnimationFrame(N)}document.addEventListener("DOMContentLoaded",$e);
