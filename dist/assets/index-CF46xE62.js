(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const x=4,I=2,q={earl_grey:{name:"Earl Grey",steepTime:3,milk:!1,sugar:"optional"},english:{name:"English Breakfast",steepTime:4,milk:!0,sugar:"optional"},peppermint:{name:"Peppermint",steepTime:2,milk:!1,sugar:"none"},chai:{name:"Chai",steepTime:5,milk:!0,sugar:"required"}},M=["earl_grey","english","peppermint","chai"];function k(e){return{id:e,kettleState:"empty",kettleTimer:0,cupState:"empty",cupTeaType:null,steepTimer:0,steepTarget:0,hasMilk:!1,sugarCount:0}}function H(e){return e.upgrades.includes("faster_kettle")?3:4}function G(e,t){switch(e.kettleState){case"empty":e.kettleState="filling",e.kettleTimer=1;break;case"full":e.kettleState="boiling",e.kettleTimer=H(t);break;case"ready":e.cupState==="has_teabag"&&e.cupTeaType&&(e.kettleState="empty",e.cupState="steeping",e.steepTimer=0,e.steepTarget=q[e.cupTeaType].steepTime);break}}function K(e,t){e.cupState==="empty"&&(e.cupState="has_teabag",e.cupTeaType=t)}function U(e){(e.cupState==="steeping"||e.cupState==="ready")&&e.sugarCount++}function V(e){(e.cupState==="steeping"||e.cupState==="ready")&&!e.hasMilk&&(e.hasMilk=!0)}function W(e,t){(e.kettleState==="filling"||e.kettleState==="boiling")&&(e.kettleTimer-=t,e.kettleTimer<=0&&(e.kettleTimer=0,e.kettleState==="filling"?e.kettleState="full":e.kettleState==="boiling"&&(e.kettleState="ready"))),e.cupState==="steeping"&&(e.steepTimer+=t,e.steepTimer>=e.steepTarget&&(e.cupState="ready"))}function E(e){e.cupState="empty",e.cupTeaType=null,e.steepTimer=0,e.steepTarget=0,e.hasMilk=!1,e.sugarCount=0}function X(e){switch(e.kettleState){case"empty":return"Empty";case"filling":return"Filling...";case"full":return"Full";case"boiling":return`Boiling ${e.kettleTimer.toFixed(1)}s`;case"ready":return"Ready!"}}function Q(e){switch(e.cupState){case"empty":return"Empty";case"has_teabag":return"Add water";case"steeping":return`Steeping ${e.steepTimer.toFixed(1)}s`;case"ready":return"Ready!"}}let Y=0;function z(e){const t=Math.max(20,45-(e.day-1)*5);return e.upgrades.includes("patience_boost")?t*1.2:t}function F(e){return 6+(e-1)*2}function $(e){return Math.min(5,2+e)}function j(e){const t=z(e);return{id:Y++,order:M[Math.floor(Math.random()*M.length)],patience:t,maxPatience:t}}function J(e,t){for(const s of e.customers)s.patience-=t;const n=e.customers.filter(s=>s.patience<=0).length;n>0&&(e.wrongOrdersToday+=n,e.wrongOrdersToday>=I&&(e.phase="gameover")),e.customers=e.customers.filter(s=>s.patience>0);const i=$(e.day);e.customers.length<i&&e.customersServed+e.customers.length<e.customersTotal&&Math.random()<t/5&&e.customers.push(j(e))}function Z(e,t,n){let i=2;const s=Math.abs(e.steepTimer-t.steepTime);return s<=1?i+=1:s>3&&(i-=1),t.milk&&e.hasMilk?i+=1:(t.milk&&!e.hasMilk||!t.milk&&e.hasMilk)&&(i-=1),t.sugar==="required"&&e.sugarCount>0?i+=1:t.sugar==="required"&&e.sugarCount===0||t.sugar==="none"&&e.sugarCount>0?i-=1:t.sugar==="optional"&&(i+=1),n.upgrades.includes("premium_cups")&&(i+=1),Math.max(0,Math.min(5,i))}function ee(e,t){if(e.servingFromStation===null)return 0;const n=e.stations[e.servingFromStation],i=e.customers[t];if(!n||!i||!n.cupTeaType)return 0;let s=0;return n.cupTeaType!==i.order?(e.wrongOrdersToday++,e.wrongOrdersToday>=I&&(e.phase="gameover")):s=Z(n,q[i.order],e),e.customers.splice(t,1),e.customersServed++,e.tips+=s,e.dayTips+=s,e.servingFromStation=null,s}function te(e){return q[e].name}const A=180;function O(){return{phase:"playing",day:1,tips:0,dayTips:0,dayTimer:A,customersServed:0,customersTotal:F(1),wrongOrdersToday:0,stations:[k(0),k(1)],customers:[],servingFromStation:null,upgrades:[]}}function ne(e,t){if(e.phase==="playing"){e.dayTimer-=t;for(const n of e.stations)W(n,t);J(e,t),(e.dayTimer<=0||e.customersServed>=e.customersTotal)&&se(e)}}function se(e){e.phase="shopping"}function ie(e){if(e.day>=x){e.phase="won";return}e.day++,e.phase="playing",e.dayTimer=A,e.dayTips=0,e.customersServed=0,e.customersTotal=F(e.day),e.wrongOrdersToday=0,e.customers=[],e.servingFromStation=null;for(const t of e.stations)t.kettleState="empty",t.kettleTimer=0,E(t);e.upgrades.includes("third_station")&&e.stations.length<3&&e.stations.push(k(2))}function ae(e){const t=Math.floor(e/60),n=Math.floor(e%60);return`${t}:${n.toString().padStart(2,"0")}`}const _=[{id:"faster_kettle",name:"Faster Kettle",description:"Boil time reduced from 4s to 3s",cost:10},{id:"third_station",name:"Third Station",description:"Unlock a third tea station",cost:25},{id:"patience_boost",name:"Comfy Chairs",description:"Customers wait 20% longer",cost:15},{id:"premium_cups",name:"Premium Cups",description:"+1 tip per order",cost:20}];function re(e,t){return e.tips>=t.cost&&!e.upgrades.includes(t.id)}function oe(e){le(e),ue(e),de(e);const t=document.getElementById("pause");e.phase==="paused"?t.classList.remove("hidden"):t.classList.add("hidden");const n=document.getElementById("shop");e.phase==="shopping"?n.classList.contains("hidden")&&(n.classList.remove("hidden"),D(e)):n.classList.add("hidden");const i=document.getElementById("gameover");e.phase==="gameover"?i.classList.contains("hidden")&&(i.classList.remove("hidden"),document.getElementById("gameover-day").textContent=String(e.day),document.getElementById("gameover-tips").textContent=String(e.tips)):i.classList.add("hidden");const s=document.getElementById("win");e.phase==="won"?s.classList.contains("hidden")&&(s.classList.remove("hidden"),document.getElementById("win-tips").textContent=String(e.tips)):s.classList.add("hidden")}function ce(e){D(e)}function le(e){document.getElementById("day-display").textContent=`Day ${e.day}/${x}`,document.getElementById("tips-display").textContent=`Tips: $${e.tips}`,document.getElementById("time-display").textContent=`Time: ${ae(e.dayTimer)}`;const t=document.getElementById("complaints-display");if(t){const n='<span class="complaint filled">X</span>'.repeat(e.wrongOrdersToday),i='<span class="complaint">X</span>'.repeat(I-e.wrongOrdersToday);t.innerHTML='<span class="complaints-label">Complaints:</span>'+n+i}}function ue(e){const t=document.querySelectorAll(".customer-slot"),n=$(e.day),i=document.getElementById("sink");i&&(e.servingFromStation!==null?i.classList.add("active"):i.classList.remove("active")),t.forEach((s,a)=>{const l=e.customers[a],r=s;if(a>=n){r.classList.add("unavailable"),r.classList.remove("occupied","serving-mode"),r.innerHTML='<div class="slot-locked">?</div>';return}if(r.classList.remove("unavailable"),l){r.classList.add("occupied"),e.servingFromStation!==null?r.classList.add("serving-mode"):r.classList.remove("serving-mode");const d=l.patience/l.maxPatience*100,p=d<30;r.innerHTML=`
        <div class="customer">
          <div class="customer-face"></div>
          <div class="customer-order">${te(l.order)}</div>
        </div>
        <div class="customer-patience">
          <div class="patience-bar ${p?"low":""}" style="width: ${d}%"></div>
        </div>
      `}else r.classList.remove("occupied","serving-mode"),r.innerHTML=""})}function de(e){const t=document.getElementById("stations"),n=document.getElementById("station-3-locked");n&&(e.upgrades.includes("third_station")?n.classList.add("hidden"):n.classList.remove("hidden")),e.upgrades.includes("third_station")&&!document.querySelector('[data-station="2"]')&&t.insertAdjacentHTML("beforeend",`
      <div class="station" data-station="2">
        <div class="station-label">Station 3</div>
        <div class="station-top">
          <div class="kettle" data-action="kettle">
            <div class="kettle-body"></div>
            <div class="kettle-status">Empty</div>
          </div>
          <div class="cup" data-action="cup">
            <div class="cup-body">
              <div class="cup-contents"></div>
              <div class="sugar-crystals"></div>
            </div>
            <div class="cup-status">Empty</div>
          </div>
        </div>
        <div class="station-bottom">
          <div class="teabags">
            <div class="teabag" data-tea="earl_grey" data-action="teabag">EG</div>
            <div class="teabag" data-tea="english" data-action="teabag">EB</div>
            <div class="teabag" data-tea="peppermint" data-action="teabag">PM</div>
            <div class="teabag" data-tea="chai" data-action="teabag">CH</div>
          </div>
          <div class="additions">
            <div class="addition" data-action="sugar">Sugar</div>
            <div class="addition" data-action="milk">Milk</div>
          </div>
        </div>
      </div>
    `),e.stations.forEach((i,s)=>{const a=document.querySelector(`[data-station="${s}"]`);if(!a)return;const l=e.servingFromStation===s;pe(i,a,l)})}function pe(e,t,n){const i=t.querySelector(".kettle");i.className=`kettle ${e.kettleState}`,t.querySelector(".kettle-status").textContent=X(e);const s=t.querySelector(".cup");let a="cup";e.cupTeaType&&(a+=` ${e.cupTeaType}`),(e.cupState==="steeping"||e.cupState==="ready")&&(a+=" has-tea"),e.cupState==="steeping"&&(a+=" steeping"),e.hasMilk&&(a+=" has-milk"),e.sugarCount>0&&(a+=" has-sugar"),e.cupState==="ready"&&(a+=" ready"),n&&(a+=" serving"),s.className=a,t.querySelector(".cup-status").textContent=Q(e)}function D(e){document.getElementById("shop-tips").textContent=`Tips: $${e.tips}`;const t=document.getElementById("upgrades");t.innerHTML="";for(const n of _){const i=e.upgrades.includes(n.id),s=re(e,n),a=document.createElement("div");a.className=`upgrade ${i?"owned":""} ${!s&&!i?"locked":""}`,a.dataset.upgradeId=n.id,a.innerHTML=`
      <div class="upgrade-name">${n.name}</div>
      <div class="upgrade-desc">${n.description}</div>
      <div class="upgrade-cost">${i?"OWNED":`$${n.cost}`}</div>
    `,t.appendChild(a)}}function me(e,t,n){const i=document.createElement("div");i.className="tip-popup",i.textContent=e>0?`+$${e}`:"$0",i.style.left=`${t}px`,i.style.top=`${n}px`,document.body.appendChild(i),setTimeout(()=>i.remove(),1e3)}let S=null,g=!1;function fe(){return g=!g,g}function P(){return S||(S=new AudioContext),S}function c(e,t,n="square",i=.3){if(g)return;const s=P(),a=s.createOscillator(),l=s.createGain();a.connect(l),l.connect(s.destination),a.type=n,a.frequency.setValueAtTime(e,s.currentTime),l.gain.setValueAtTime(i,s.currentTime),l.gain.exponentialRampToValueAtTime(.01,s.currentTime+t),a.start(s.currentTime),a.stop(s.currentTime+t)}function y(e,t=.1){if(g)return;const n=P(),i=n.sampleRate*e,s=n.createBuffer(1,i,n.sampleRate),a=s.getChannelData(0);for(let p=0;p<i;p++)a[p]=Math.random()*2-1;const l=n.createBufferSource(),r=n.createGain(),d=n.createBiquadFilter();l.buffer=s,d.type="lowpass",d.frequency.setValueAtTime(1e3,n.currentTime),l.connect(d),d.connect(r),r.connect(n.destination),r.gain.setValueAtTime(t,n.currentTime),r.gain.exponentialRampToValueAtTime(.01,n.currentTime+e),l.start(n.currentTime),l.stop(n.currentTime+e)}function ge(){y(.3,.05),c(200,.1,"sine",.1),setTimeout(()=>c(250,.1,"sine",.1),100)}function ye(){y(.2,.08),c(150,.15,"triangle",.15)}function ve(){c(880,.1,"sine",.2),setTimeout(()=>c(1100,.15,"sine",.2),100)}function Te(){for(let e=0;e<5;e++)setTimeout(()=>{c(400-e*40,.08,"sine",.1),y(.05,.03)},e*60)}function he(){c(180,.1,"triangle",.2),setTimeout(()=>c(120,.08,"triangle",.15),50)}function Se(){c(523,.15,"sine",.15),setTimeout(()=>c(659,.15,"sine",.15),120),setTimeout(()=>c(784,.2,"sine",.15),240)}function ke(){y(.15,.05),c(300,.1,"sine",.1)}function Ee(){for(let e=0;e<3;e++)setTimeout(()=>{c(1200+Math.random()*400,.05,"square",.08)},e*40)}function Ce(e){e>=4?(c(523,.1,"square",.2),setTimeout(()=>c(659,.1,"square",.2),80),setTimeout(()=>c(784,.1,"square",.2),160),setTimeout(()=>c(1047,.2,"square",.25),240)):e>=2?(c(440,.1,"square",.2),setTimeout(()=>c(554,.15,"square",.2),100)):(c(330,.15,"square",.2),setTimeout(()=>c(262,.2,"square",.2),120))}function Le(){c(660,.08,"sine",.15),setTimeout(()=>c(880,.12,"sine",.15),80)}function be(){c(294,.15,"square",.2),setTimeout(()=>c(220,.2,"square",.2),100),setTimeout(()=>c(165,.25,"square",.15),200)}function Be(){[523,587,659,784].forEach((t,n)=>{setTimeout(()=>c(t,.2,"square",.2),n*150)})}function Ie(){c(988,.08,"square",.2),setTimeout(()=>c(1319,.15,"square",.25),80)}function w(){c(800,.05,"square",.15)}function qe(){c(600,.1,"square",.2),setTimeout(()=>c(400,.15,"square",.2),80)}function Me(){c(400,.1,"square",.2),setTimeout(()=>c(600,.15,"square",.2),80)}function we(){y(.3,.1),c(200,.15,"triangle",.15),setTimeout(()=>c(150,.15,"triangle",.1),100),setTimeout(()=>c(100,.2,"triangle",.08),200)}let o,C=0,v=!1,L=[],b=[],T=0,B="playing";function xe(){o=O(),Fe(),C=performance.now(),requestAnimationFrame(R)}function Fe(){const e=document.getElementById("stations"),t=document.getElementById("customer-queue");e.addEventListener("click",r=>{const d=r.target,p=d.closest(".station");if(!p)return;const m=parseInt(p.dataset.station||"0"),u=o.stations[m];if(!u)return;const f=d.closest("[data-action]");if(!f)return;switch(f.dataset.action){case"kettle":const h=u.kettleState;G(u,o),h==="empty"&&u.kettleState==="filling"?ge():h==="full"&&u.kettleState==="boiling"?ye():h==="ready"&&u.cupState==="steeping"&&Te();break;case"teabag":const N=f.dataset.tea;u.cupState==="empty"&&he(),K(u,N);break;case"sugar":(u.cupState==="steeping"||u.cupState==="ready")&&Ee(),U(u);break;case"milk":(u.cupState==="steeping"||u.cupState==="ready")&&!u.hasMilk&&ke(),V(u);break;case"cup":u.cupState==="ready"&&(w(),o.servingFromStation===m?o.servingFromStation=null:o.servingFromStation=m);break}}),t.addEventListener("click",r=>{if(o.servingFromStation===null)return;const d=r.target.closest(".customer-slot");if(!d)return;const p=parseInt(d.dataset.slot||"0");if(!o.customers[p])return;const m=o.servingFromStation,u=ee(o,p);Ce(u);const f=d.getBoundingClientRect();me(u,f.left+f.width/2,f.top),E(o.stations[m])}),document.getElementById("next-day-btn").addEventListener("click",()=>{w(),ie(o),T=0}),document.getElementById("sink").addEventListener("click",()=>{if(o.servingFromStation===null)return;const r=o.stations[o.servingFromStation];r&&r.cupState==="ready"&&(we(),E(r),o.servingFromStation=null)}),document.addEventListener("click",r=>{const d=r.target;if(!d.closest("#upgrades"))return;const p=d.closest(".upgrade");if(!p||p.classList.contains("owned")||p.classList.contains("locked"))return;const m=p.dataset.upgradeId;if(m){const u=_.find(f=>f.id===m);u&&o.tips>=u.cost&&(o.tips-=u.cost,o.upgrades.push(m),Ie(),ce(o))}});const n=document.getElementById("restart-confirm");document.getElementById("restart-yes").addEventListener("click",l),document.getElementById("restart-no").addEventListener("click",a),document.getElementById("gameover-restart-btn").addEventListener("click",l),document.getElementById("win-restart-btn").addEventListener("click",l);const i=document.getElementById("mute-btn");i.addEventListener("click",()=>{const r=fe();i.textContent=r?"Sound: OFF":"Sound: ON"});function s(){v=!0,n.classList.remove("hidden")}function a(){v=!1,n.classList.add("hidden")}function l(){v=!1,n.classList.add("hidden"),o=O(),L=[],b=[],T=0,B="playing"}document.addEventListener("keydown",r=>{if(v){r.key==="Escape"?(r.preventDefault(),a()):r.key==="Enter"&&(r.preventDefault(),l());return}(r.key==="p"||r.key==="P"||r.key===" "||r.key==="Escape")&&(r.preventDefault(),o.phase==="playing"?r.key==="Escape"&&o.servingFromStation!==null?o.servingFromStation=null:(o.phase="paused",qe()):o.phase==="paused"&&(o.phase="playing",Me())),(r.key==="r"||r.key==="R")&&(r.preventDefault(),o.phase==="gameover"||o.phase==="won"?l():o.phase!=="shopping"&&s())})}function R(e){const t=(e-C)/1e3;if(C=e,o.phase==="playing"){const n=o.customers.map(a=>a.id);ne(o,t),o.stations.forEach((a,l)=>{L[l]==="boiling"&&a.kettleState==="ready"&&ve(),b[l]==="steeping"&&a.cupState==="ready"&&Se(),L[l]=a.kettleState,b[l]=a.cupState}),o.customers.length>T&&Le();const i=o.customers.map(a=>a.id);n.filter(a=>!i.includes(a)).length>0&&o.phase==="playing"&&be(),T=o.customers.length}B==="playing"&&o.phase==="shopping"&&Be(),B=o.phase,oe(o),requestAnimationFrame(R)}document.addEventListener("DOMContentLoaded",xe);
