(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function a(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=a(n);fetch(n.href,s)}})();const M=4,A=2,q={earl_grey:{name:"Earl Grey",steepTime:3,milk:!1,sugar:"optional"},english:{name:"English Breakfast",steepTime:4,milk:!0,sugar:"optional"},peppermint:{name:"Peppermint",steepTime:2,milk:!1,sugar:"none"},chai:{name:"Chai",steepTime:5,milk:!0,sugar:"required"}},O=["earl_grey","english","peppermint","chai"];function w(e){return{id:e,kettleState:"empty",kettleTimer:0,cupState:"empty",cupTeaType:null,pendingTeaType:null,teabagChangeTimer:0,steepTimer:0,steepTarget:0,hasMilk:!1,sugarCount:0}}function U(e){return e.upgrades.includes("faster_kettle")?3:4}function W(e,t){switch(e.kettleState){case"empty":e.kettleState="filling",e.kettleTimer=1;break;case"full":e.kettleState="boiling",e.kettleTimer=U(t);break;case"ready":e.cupState==="has_teabag"&&e.cupTeaType&&(e.kettleState="empty",e.cupState="steeping",e.steepTimer=0,e.steepTarget=q[e.cupTeaType].steepTime);break}}function Y(e,t){e.cupState==="empty"?(e.cupState="has_teabag",e.cupTeaType=t):e.cupState==="has_teabag"&&e.cupTeaType!==t&&e.teabagChangeTimer===0&&(e.pendingTeaType=t,e.teabagChangeTimer=1)}function X(e){(e.cupState==="steeping"||e.cupState==="ready")&&e.sugarCount++}function Q(e){(e.cupState==="steeping"||e.cupState==="ready")&&!e.hasMilk&&(e.hasMilk=!0)}function j(e,t){(e.kettleState==="filling"||e.kettleState==="boiling")&&(e.kettleTimer-=t,e.kettleTimer<=0&&(e.kettleTimer=0,e.kettleState==="filling"?e.kettleState="full":e.kettleState==="boiling"&&(e.kettleState="ready"))),e.teabagChangeTimer>0&&(e.teabagChangeTimer-=t,e.teabagChangeTimer<=0&&(e.teabagChangeTimer=0,e.pendingTeaType&&(e.cupTeaType=e.pendingTeaType,e.pendingTeaType=null))),e.cupState==="steeping"&&(e.steepTimer+=t,e.steepTimer>=e.steepTarget&&(e.cupState="ready"))}function x(e){e.cupState="empty",e.cupTeaType=null,e.pendingTeaType=null,e.teabagChangeTimer=0,e.steepTimer=0,e.steepTarget=0,e.hasMilk=!1,e.sugarCount=0}function z(e){switch(e.kettleState){case"empty":return"Empty";case"filling":return"Filling...";case"full":return"Full";case"boiling":return`Boiling ${e.kettleTimer.toFixed(1)}s`;case"ready":return"Ready!"}}function J(e){if(e.teabagChangeTimer>0)return"Changing...";switch(e.cupState){case"empty":return"Empty";case"has_teabag":return"Add water";case"steeping":return`Steeping ${e.steepTimer.toFixed(1)}s`;case"ready":return"Ready!"}}function F(e){return e.upgrades.includes("relationship_building")?A+1:A}let Z=0;function ee(e){const t=Math.max(18,40-(e.day-1)*8);return e.upgrades.includes("patience_boost")?t*1.2:t}function D(e){return 6+(e-1)*3}function te(e){return Math.max(3,5-(e-1)*.7)}function P(e){return Math.min(5,2+e)}function ne(e){const t=ee(e);return{id:Z++,order:O[Math.floor(Math.random()*O.length)],patience:t,maxPatience:t}}function ie(e,t){for(const n of e.customers)n.patience-=t;const a=e.customers.filter(n=>n.patience<=0).length;a>0&&(e.wrongOrdersToday+=a,e.satisfaction=Math.max(0,e.satisfaction-a),e.wrongOrdersToday>=F(e)&&(e.phase="gameover")),e.customers=e.customers.filter(n=>n.patience>0);const i=P(e.day);if(e.customers.length<i&&e.customersServed+e.customers.length<e.customersTotal){const n=te(e.day);Math.random()<t/n&&e.customers.push(ne(e))}}function se(e,t,a){let i=2;const n=Math.abs(e.steepTimer-t.steepTime);return n<=1?i+=1:n>3&&(i-=1),t.milk&&e.hasMilk?i+=1:(t.milk&&!e.hasMilk||!t.milk&&e.hasMilk)&&(i-=1),t.sugar==="required"&&e.sugarCount>0?i+=1:(t.sugar==="required"&&e.sugarCount===0||t.sugar==="none"&&e.sugarCount>0)&&(i-=1),a.upgrades.includes("premium_cups")&&(i+=1),Math.max(0,Math.min(5,i))}function ae(e,t){if(e.servingFromStation===null)return 0;const a=e.stations[e.servingFromStation],i=e.customers[t];if(!a||!i||!a.cupTeaType)return 0;let n=0;return a.cupTeaType!==i.order?(e.wrongOrdersToday++,e.wrongOrdersToday>=F(e)&&(e.phase="gameover")):n=se(a,q[i.order],e),n>=5?e.satisfaction=Math.min(4,e.satisfaction+1):n<=1&&(e.satisfaction=Math.max(0,e.satisfaction-1)),e.satisfactionSum+=e.satisfaction,e.satisfactionSamples++,e.customers.splice(t,1),e.customersServed++,e.tips+=n,e.dayTips+=n,e.servingFromStation=null,n}function re(e){return q[e].name}const R=180;function I(e=!1){return{phase:"playing",day:1,tips:e?100:0,dayTips:0,dayTimer:R,satisfaction:2,satisfactionSum:0,satisfactionSamples:0,customersServed:0,customersTotal:e?3:D(1),wrongOrdersToday:0,stations:[w(0),w(1)],customers:[],servingFromStation:null,upgrades:[],devMode:e}}function oe(e,t){if(e.phase==="playing"){e.dayTimer-=t;for(const a of e.stations)j(a,t);ie(e,t),(e.dayTimer<=0||e.customersServed>=e.customersTotal)&&ce(e)}}function ce(e){e.day>=M?e.phase="won":e.phase="shopping"}function le(e){if(e.day>=M){e.phase="won";return}e.day++,e.phase="playing",e.dayTimer=R,e.dayTips=0,e.customersServed=0,e.customersTotal=e.devMode?3:D(e.day),e.wrongOrdersToday=0,e.customers=[],e.servingFromStation=null;for(const t of e.stations)t.kettleState="empty",t.kettleTimer=0,x(t);e.upgrades.includes("third_station")&&e.stations.length<3&&e.stations.push(w(2))}const N=[{id:"faster_kettle",name:"Faster Kettle",description:"Boil time reduced from 4s to 3s",cost:10},{id:"third_station",name:"Third Station",description:"Unlock a third tea station",cost:25},{id:"patience_boost",name:"Comfy Chairs",description:"Customers wait 20% longer",cost:15},{id:"premium_cups",name:"Premium Cups",description:"+1 tip per order",cost:20},{id:"relationship_building",name:"Relationship Building",description:"Customers forgive one extra mistake",cost:15}];function ue(e,t){return e.tips>=t.cost&&!e.upgrades.includes(t.id)}function de(e){me(e),fe(e),ge(e);const t=document.getElementById("pause");e.phase==="paused"?t.classList.remove("hidden"):t.classList.add("hidden");const a=document.getElementById("shop");e.phase==="shopping"?a.classList.contains("hidden")&&(a.classList.remove("hidden"),H(e)):a.classList.add("hidden");const i=document.getElementById("gameover");e.phase==="gameover"?i.classList.contains("hidden")&&(i.classList.remove("hidden"),document.getElementById("gameover-title").textContent="Terminated",document.getElementById("gameover-message").textContent="Your services are no longer required. The Council has replaced you with a robot."):i.classList.add("hidden");const n=document.getElementById("win");if(e.phase==="won"){if(n.classList.contains("hidden")){n.classList.remove("hidden"),document.getElementById("win-tips").textContent=String(e.tips);const s=e.satisfactionSamples>0?e.satisfactionSum/e.satisfactionSamples:2,o=document.getElementById("win-title"),d=document.getElementById("win-message");s>=3?(o.textContent="Victory... For Them",d.textContent="Due to your tea-making virtuosity, the Alien Council made excellent decisions all week. Their fleet has conquered Earth. Humanity has fallen."):s<=1.5?(o.textContent="Secret Hero",d.textContent="Served with subtly bad tea, the Alien Council made poor decisions throughout the week. Their invasion failed. Humanity survives, never knowing they were saved by a tea server."):(o.textContent="Stalemate",d.textContent="Your adequate tea led to adequate decisions. The war continues, neither side gaining advantage. The Council keeps you employed... for now.")}}else n.classList.add("hidden")}function pe(e){H(e)}function me(e){document.getElementById("day-display").textContent=`Day ${e.day}/${M}`,document.getElementById("tips-display").textContent=`Tips: $${e.tips}`;const t=document.getElementById("satisfaction-display");if(t){let i="";for(let n=0;n<5;n++){const s=n<=e.satisfaction;i+=`<span class="satisfaction-bar bar-${n} ${s?"filled":""}"></span>`}t.innerHTML='<span class="satisfaction-label">Mood:</span>'+i}const a=document.getElementById("complaints-display");if(a){const i=F(e),n='<span class="complaint filled">X</span>'.repeat(e.wrongOrdersToday),s='<span class="complaint">X</span>'.repeat(i-e.wrongOrdersToday);a.innerHTML='<span class="complaints-label">Complaints:</span>'+n+s}}function fe(e){const t=document.querySelectorAll(".customer-slot"),a=P(e.day),i=document.getElementById("sink");i&&(e.servingFromStation!==null?i.classList.add("active"):i.classList.remove("active")),t.forEach((n,s)=>{const o=e.customers[s],d=n;if(s>=a){d.classList.add("unavailable"),d.classList.remove("occupied","serving-mode"),d.innerHTML='<div class="slot-locked">?</div>';return}if(d.classList.remove("unavailable"),o){d.classList.add("occupied"),e.servingFromStation!==null?d.classList.add("serving-mode"):d.classList.remove("serving-mode");const l=o.patience/o.maxPatience*100,p=l<30;d.innerHTML=`
        <div class="customer">
          <div class="customer-face"></div>
          <div class="customer-order">${re(o.order)}</div>
        </div>
        <div class="customer-patience">
          <div class="patience-bar ${p?"low":""}" style="width: ${l}%"></div>
        </div>
      `}else d.classList.remove("occupied","serving-mode"),d.innerHTML=""})}function ge(e){const t=document.getElementById("stations"),a=document.getElementById("station-3-locked");a&&(e.upgrades.includes("third_station")?a.classList.add("hidden"):a.classList.remove("hidden")),e.upgrades.includes("third_station")&&!document.querySelector('[data-station="2"]')&&t.insertAdjacentHTML("beforeend",`
      <div class="station" data-station="2">
        <div class="station-label">Station 3</div>
        <div class="station-top">
          <div class="kettle" data-action="kettle">
            <div class="kettle-body"></div>
            <div class="kettle-status">Empty</div>
          </div>
          <div class="cup" data-action="cup">
            <div class="cup-body">
              <div class="cup-contents"></div>
              <div class="sugar-crystals"></div>
            </div>
            <div class="cup-status">Empty</div>
          </div>
        </div>
        <div class="station-bottom">
          <div class="teabags">
            <div class="teabag" data-tea="earl_grey" data-action="teabag">EG</div>
            <div class="teabag" data-tea="english" data-action="teabag">EB</div>
            <div class="teabag" data-tea="peppermint" data-action="teabag">PM</div>
            <div class="teabag" data-tea="chai" data-action="teabag">CH</div>
          </div>
          <div class="additions">
            <div class="addition" data-action="sugar">Sugar</div>
            <div class="addition" data-action="milk">Milk</div>
          </div>
        </div>
      </div>
    `),e.stations.forEach((i,n)=>{const s=document.querySelector(`[data-station="${n}"]`);if(!s)return;const o=e.servingFromStation===n;ye(i,s,o)})}function ye(e,t,a){const i=t.querySelector(".kettle");i.className=`kettle ${e.kettleState}`,t.querySelector(".kettle-status").textContent=z(e);const n=t.querySelector(".cup");let s="cup";e.cupTeaType&&(s+=` ${e.cupTeaType}`),e.cupState==="has_teabag"&&(s+=" has-teabag"),(e.cupState==="steeping"||e.cupState==="ready")&&(s+=" has-tea"),e.cupState==="steeping"&&(s+=" steeping"),e.hasMilk&&(s+=" has-milk"),e.sugarCount>0&&(s+=" has-sugar"),e.cupState==="ready"&&(s+=" ready"),a&&(e.cupState==="steeping"||e.cupState==="ready")&&(s+=" serving"),e.teabagChangeTimer>0&&(s+=" changing-teabag"),n.className=s,t.querySelector(".cup-status").textContent=J(e)}const $=['"The Council seems pleased. Strange customers, though... their skin has an odd shimmer."',`"Overheard them discussing 'the invasion timeline'. Must be some corporate jargon."`,`"One of them slipped up and mentioned 'the human resistance'. Probably a movie reference?"`];function H(e){document.getElementById("shop-tips").textContent=`Tips: $${e.tips}`;const t=document.getElementById("shop-hint");t&&e.day<=$.length&&(t.textContent=$[e.day-1]);const a=document.getElementById("upgrades");a.innerHTML="";for(const i of N){const n=e.upgrades.includes(i.id),s=ue(e,i),o=document.createElement("div");o.className=`upgrade ${n?"owned":""} ${!s&&!n?"locked":""}`,o.dataset.upgradeId=i.id,o.innerHTML=`
      <div class="upgrade-name">${i.name}</div>
      <div class="upgrade-desc">${i.description}</div>
      <div class="upgrade-cost">${n?"OWNED":`$${i.cost}`}</div>
    `,a.appendChild(o)}}function he(e,t,a){const i=document.createElement("div");i.className="tip-popup",i.textContent=e>0?`+$${e}`:"$0",i.style.left=`${t}px`,i.style.top=`${a}px`,document.body.appendChild(i),setTimeout(()=>i.remove(),1e3)}let L=null,h=!1;function ve(){return h=!h,h}function G(){return L||(L=new AudioContext),L}function c(e,t,a="square",i=.3){if(h)return;const n=G(),s=n.createOscillator(),o=n.createGain();s.connect(o),o.connect(n.destination),s.type=a,s.frequency.setValueAtTime(e,n.currentTime),o.gain.setValueAtTime(i,n.currentTime),o.gain.exponentialRampToValueAtTime(.01,n.currentTime+t),s.start(n.currentTime),s.stop(n.currentTime+t)}function T(e,t=.1){if(h)return;const a=G(),i=a.sampleRate*e,n=a.createBuffer(1,i,a.sampleRate),s=n.getChannelData(0);for(let p=0;p<i;p++)s[p]=Math.random()*2-1;const o=a.createBufferSource(),d=a.createGain(),l=a.createBiquadFilter();o.buffer=n,l.type="lowpass",l.frequency.setValueAtTime(1e3,a.currentTime),o.connect(l),l.connect(d),d.connect(a.destination),d.gain.setValueAtTime(t,a.currentTime),d.gain.exponentialRampToValueAtTime(.01,a.currentTime+e),o.start(a.currentTime),o.stop(a.currentTime+e)}function Te(){T(.3,.05),c(200,.1,"sine",.1),setTimeout(()=>c(250,.1,"sine",.1),100)}function Se(){T(.2,.08),c(150,.15,"triangle",.15)}function ke(){c(880,.1,"sine",.2),setTimeout(()=>c(1100,.15,"sine",.2),100)}function Ee(){for(let e=0;e<5;e++)setTimeout(()=>{c(400-e*40,.08,"sine",.1),T(.05,.03)},e*60)}function be(){c(180,.1,"triangle",.2),setTimeout(()=>c(120,.08,"triangle",.15),50)}function Ce(){c(523,.15,"sine",.15),setTimeout(()=>c(659,.15,"sine",.15),120),setTimeout(()=>c(784,.2,"sine",.15),240)}function Le(){T(.15,.05),c(300,.1,"sine",.1)}function we(){for(let e=0;e<3;e++)setTimeout(()=>{c(1200+Math.random()*400,.05,"square",.08)},e*40)}function xe(e){e>=4?(c(523,.1,"square",.2),setTimeout(()=>c(659,.1,"square",.2),80),setTimeout(()=>c(784,.1,"square",.2),160),setTimeout(()=>c(1047,.2,"square",.25),240)):e>=2?(c(440,.1,"square",.2),setTimeout(()=>c(554,.15,"square",.2),100)):(c(330,.15,"square",.2),setTimeout(()=>c(262,.2,"square",.2),120))}function Ie(){c(660,.08,"sine",.15),setTimeout(()=>c(880,.12,"sine",.15),80)}function Be(){c(294,.15,"square",.2),setTimeout(()=>c(220,.2,"square",.2),100),setTimeout(()=>c(165,.25,"square",.15),200)}function Me(){[523,587,659,784].forEach((t,a)=>{setTimeout(()=>c(t,.2,"square",.2),a*150)})}function qe(){c(988,.08,"square",.2),setTimeout(()=>c(1319,.15,"square",.25),80)}function _(){c(800,.05,"square",.15)}function Fe(){c(600,.1,"square",.2),setTimeout(()=>c(400,.15,"square",.2),80)}function Ae(){c(400,.1,"square",.2),setTimeout(()=>c(600,.15,"square",.2),80)}function Oe(){T(.3,.1),c(200,.15,"triangle",.15),setTimeout(()=>c(150,.15,"triangle",.1),100),setTimeout(()=>c(100,.2,"triangle",.08),200)}let r,B=0,S=!1,y=!1,k=[],E=[],v=0,b="playing";function $e(){r=I(),_e(),B=performance.now(),requestAnimationFrame(K)}function _e(){const e=document.getElementById("stations"),t=document.getElementById("customer-queue");e.addEventListener("click",l=>{const p=l.target,m=p.closest(".station");if(!m)return;const f=parseInt(m.dataset.station||"0"),u=r.stations[f];if(!u)return;const g=p.closest("[data-action]");if(!g)return;switch(g.dataset.action){case"kettle":const C=u.kettleState;W(u,r),C==="empty"&&u.kettleState==="filling"?Te():C==="full"&&u.kettleState==="boiling"?Se():C==="ready"&&u.cupState==="steeping"&&Ee();break;case"teabag":const V=g.dataset.tea;u.cupState==="empty"&&be(),Y(u,V);break;case"sugar":(u.cupState==="steeping"||u.cupState==="ready")&&we(),X(u);break;case"milk":(u.cupState==="steeping"||u.cupState==="ready")&&!u.hasMilk&&Le(),Q(u);break;case"cup":(u.cupState==="steeping"||u.cupState==="ready")&&(_(),r.servingFromStation===f?r.servingFromStation=null:r.servingFromStation=f);break}}),t.addEventListener("click",l=>{if(r.servingFromStation===null)return;const p=l.target.closest(".customer-slot");if(!p)return;const m=parseInt(p.dataset.slot||"0");if(!r.customers[m])return;const f=r.servingFromStation,u=ae(r,m);xe(u);const g=p.getBoundingClientRect();he(u,g.left+g.width/2,g.top),x(r.stations[f])}),document.getElementById("next-day-btn").addEventListener("click",()=>{_(),le(r),v=0}),document.getElementById("sink").addEventListener("click",()=>{if(r.servingFromStation===null)return;const l=r.stations[r.servingFromStation];l&&(l.cupState==="steeping"||l.cupState==="ready")&&(Oe(),x(l),r.servingFromStation=null)}),document.addEventListener("click",l=>{const p=l.target;if(!p.closest("#upgrades"))return;const m=p.closest(".upgrade");if(!m||m.classList.contains("owned")||m.classList.contains("locked"))return;const f=m.dataset.upgradeId;if(f){const u=N.find(g=>g.id===f);u&&r.tips>=u.cost&&(r.tips-=u.cost,r.upgrades.push(f),qe(),pe(r))}});const a=document.getElementById("restart-confirm");document.getElementById("restart-yes").addEventListener("click",o),document.getElementById("restart-no").addEventListener("click",s),document.getElementById("gameover-restart-btn").addEventListener("click",o),document.getElementById("win-restart-btn").addEventListener("click",o);const i=document.getElementById("mute-btn");i.addEventListener("click",()=>{const l=ve();i.textContent=l?"Sound: OFF":"Sound: ON"});function n(){S=!0,a.classList.remove("hidden")}function s(){S=!1,a.classList.add("hidden")}function o(){S=!1,a.classList.add("hidden"),r=I(y),k=[],E=[],v=0,b="playing"}const d=document.getElementById("dev-btn");d.addEventListener("click",()=>{y=!y,d.textContent=y?"Dev: ON":"Dev: OFF",r=I(y),k=[],E=[],v=0,b="playing"}),document.addEventListener("keydown",l=>{if(S){l.key==="Escape"?(l.preventDefault(),s()):l.key==="Enter"&&(l.preventDefault(),o());return}(l.key==="p"||l.key==="P"||l.key===" "||l.key==="Escape")&&(l.preventDefault(),r.phase==="playing"?l.key==="Escape"&&r.servingFromStation!==null?r.servingFromStation=null:(r.phase="paused",Fe()):r.phase==="paused"&&(r.phase="playing",Ae())),(l.key==="r"||l.key==="R")&&(l.preventDefault(),r.phase==="gameover"||r.phase==="won"?o():r.phase!=="shopping"&&n())})}function K(e){const t=(e-B)/1e3;if(B=e,r.phase==="playing"){const a=r.customers.map(s=>s.id);oe(r,t),r.stations.forEach((s,o)=>{k[o]==="boiling"&&s.kettleState==="ready"&&ke(),E[o]==="steeping"&&s.cupState==="ready"&&Ce(),k[o]=s.kettleState,E[o]=s.cupState}),r.customers.length>v&&Ie();const i=r.customers.map(s=>s.id);a.filter(s=>!i.includes(s)).length>0&&r.phase==="playing"&&Be(),v=r.customers.length}b==="playing"&&r.phase==="shopping"&&Me(),b=r.phase,de(r),requestAnimationFrame(K)}document.addEventListener("DOMContentLoaded",$e);
